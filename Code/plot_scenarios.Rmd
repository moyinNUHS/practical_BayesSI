---
title: "Plots for simulation scenarios"
author: "Mo Yin"
date: "2023-09-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# clean environment 
rm(list = ls())

# set working directory to the `practical/` folder 
wd = '~/Documents/GitHub/practical/'
setwd(wd)

# load libraries and functions
scripts = paste0(wd, 'Code/Functions/', list.files(paste0(wd, 'Code/Functions/')))
lapply(scripts, source)

# load data in the output folder 
files = list.files(path = paste0(wd, 'Code/Run_output'), full.names = TRUE, pattern = "10_2023-09-08*.rds")
outputs = list()
for (file in files){
  outputs[[sub('.*/', '', file)]] = readRDS(file)
}

# define colors and shapes 
method_labs = c("Fixed-effect (frequentist)", "Fixed-effect (Bayesian, non-informative prior)",
                "Fixed-effect (Bayesian, weakly-informative prior)", "Fixed-effect (Bayesian, strongly-informative prior)", 
                "Mixed-effect (frequentist)", "Mixed-effect (Bayesian, non-informative prior)", 
                "Fixed-effect (Bayesian, weakly-informative prior)", "Fixed-effect (Bayesian, strongly-informative prior)")
shapes = c(0, 1, 2, 5, 15, 16, 17, 18)
colors = c("#1f78b4",  "#33a02c", "#e31a1c", "#ff7f00", "#6a3d9a", "#a6cee3", "#b2df8a", "#fb9a99")
names(shapes) = names(colors) = method_labs
```

## Final analysis report {.tabset .tabset-fade .tabset-pills}

### Bias, Coverage, MSE

Each point from left to right for each method represents a performance measure of an estimated \ncontrast between treatments 2, 3, and 4 relative to treatment 1.

#### Scenario 1.1

```{r, echo = FALSE, fig.align="center",fig.height = 6, fig.width = 12}

ind = grep('1.1', files)
if (length(ind) == 1) {
  f = plot_biasmse(Scenario = '1.1', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/biasmse_scenario1.1_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```


#### Scenario 1.2
Treatment B is better than treatments A, C and D: 
$T_B = 35%$; and 
$T_j = 45%$, $j = A, C, D$

```{r, echo = FALSE, fig.align="center",fig.height = 6, fig.width = 12}

ind = grep('1.2', files)
if (length(ind) == 1) {
  f = plot_biasmse(Scenario = '1.2', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/biasmse_scenario1.2_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```

#### Scenario 1.3
All 4 treatments have different effects (small difference):
$T_A = 30%$; $T_B = 35%$; $T_C = 40%$; $T_D = 45%$

```{r, echo = FALSE, fig.align="center",fig.height = 6, fig.width = 12}

ind = grep('1.3', files)
if (length(ind) == 1) {
  f = plot_biasmse(Scenario = '1.3', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/biasmse_scenario1.3_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```


### Mortality gain

#### Scenario 1.2
Treatment B is better than treatments A, C and D: 
$T_B = 35%$; and 
$T_j = 45%$, $j = A, C, D$

```{r, echo = FALSE, fig.align="center",fig.height = 6, fig.width = 12}

ind = grep('1.2', files)
if (length(ind) == 1) {
  f = plot_mort(Scenario = '1.2', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/mort_scenario1.2_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```

#### Scenario 1.3
All 4 treatments have different effects (small difference):
$T_A = 30%$; $T_B = 35%$; $T_C = 40%$; $T_D = 45%$

```{r, echo = FALSE, fig.align="center",fig.height = 6, fig.width = 12}

ind = grep('1.3', files)
if (length(ind) == 1) {
  f = plot_mort(Scenario = '1.3', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/mort_scenario1.3_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```


### Power

#### Scenario 1.2
Treatment B is better than treatments A, C and D: 
TB = 35%; and 
Tj = 45%, j = A, C, D

```{r, echo = FALSE, fig.align="center",fig.height = 6, fig.width = 12}

ind = grep('1.2', files)
if (length(ind) == 1) {
  f = plot_type2(Scenario = '1.2', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/type2_scenario1.2_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```

#### Scenario 1.3
All 4 treatments have different effects (small difference):
TA = 30%; TB = 35%; TC = 40%; TD = 45%

```{r, echo = FALSE, fig.align="center",fig.height = 12, fig.width = 12}

ind = grep('1.3', files)
if (length(ind) == 1) {
  f = plot_type2(Scenario = '1.3', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/type2_scenario1.3_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```

### Type 1 error

#### Scenario 1.1

```{r, echo = FALSE, fig.align="center",fig.height = 10, fig.width = 12}

ind = grep('1.1', files)
if (length(ind) == 1) {
  f = plot_type1(Scenario = '1.1', d = outputs[[ind]])
} else {
  message('There are multiple output files in `output`. Please select one.')
}

f

#ggsave(paste0(wd,"Code/Plots/type1_scenario1.1_", Sys.Date(), ".pdf"), f, width = 8, height = 7)

```